module.exports=function(e){var t={};function r(n){if(t[n])return t[n].exports;var o=t[n]={i:n,l:!1,exports:{}};return e[n].call(o.exports,o,o.exports,r),o.l=!0,o.exports}return r.m=e,r.c=t,r.d=function(e,t,n){r.o(e,t)||Object.defineProperty(e,t,{enumerable:!0,get:n})},r.r=function(e){"undefined"!=typeof Symbol&&Symbol.toStringTag&&Object.defineProperty(e,Symbol.toStringTag,{value:"Module"}),Object.defineProperty(e,"__esModule",{value:!0})},r.t=function(e,t){if(1&t&&(e=r(e)),8&t)return e;if(4&t&&"object"==typeof e&&e&&e.__esModule)return e;var n=Object.create(null);if(r.r(n),Object.defineProperty(n,"default",{enumerable:!0,value:e}),2&t&&"string"!=typeof e)for(var o in e)r.d(n,o,function(t){return e[t]}.bind(null,o));return n},r.n=function(e){var t=e&&e.__esModule?function(){return e.default}:function(){return e};return r.d(t,"a",t),t},r.o=function(e,t){return Object.prototype.hasOwnProperty.call(e,t)},r.p="",r(r.s=0)}({"./src/api/v1/handlers/health.js":function(e,t,r){"use strict";t.__esModule=!0,t.default=function(){var e=function(e){return function(){var t=e.apply(this,arguments);return new Promise(function(e,r){return function n(o,s){try{var u=t[o](s),i=u.value}catch(e){return void r(e)}if(!u.done)return Promise.resolve(i).then(function(e){n("next",e)},function(e){n("throw",e)});e(i)}("next")})}}(regeneratorRuntime.mark(function e(t){return regeneratorRuntime.wrap(function(e){for(;;)switch(e.prev=e.next){case 0:t.status=200,t.body="OK";case 2:case"end":return e.stop()}},e,this)}));return function(t){return e.apply(this,arguments)}}()},"./src/api/v1/routes/index.js":function(e,t,r){"use strict";t.__esModule=!0;var n=s(r("koa-router")),o=s(r("./src/api/v1/handlers/health.js"));function s(e){return e&&e.__esModule?e:{default:e}}var u=new n.default;u.get("/health",o.default),t.default=u},"./src/error/codes.js":function(e,t,r){"use strict";t.__esModule=!0;var n=t.DEFAULT_FATAL_ERROR="An error occurred. If this error persists, please contact your System Administrator",o=(t.FATAL_ERROR=function(){return{status:500,code:-1,category:"IllegalStateException",message:arguments.length>0&&void 0!==arguments[0]?arguments[0]:n}},t.DEFAULT_GENERAL_ERROR="Our hamsters don't know how to handle that request"),s=(t.GENERAL_ERROR=function(){return{status:400,code:"0a",category:"GeneralException",message:arguments.length>0&&void 0!==arguments[0]?arguments[0]:o}},t.NOT_YET_IMPLEMENTED=function(){return{status:501,code:1,category:"NotYetImplemented",message:"This method must be implmented"}},t.ILLEGAL_STATE_EXCEPTION=function(){return{status:500,code:2,category:"IllegalStateException",message:"Application not configured correctly"}},t.DEFAULT_INVALID_REQUEST="Our hamsters don't know how to handle that request"),u=(t.INVALID_REQUEST=function(){return{status:400,code:3,category:"UserError",message:arguments.length>0&&void 0!==arguments[0]?arguments[0]:s}},t.UNAUTHORIZED=function(){return{status:401,code:4,category:"SecurityException",message:arguments.length>0&&void 0!==arguments[0]?arguments[0]:"Your session is no longer valid. Please login and rety"}},t.DEFAULT_FORBIDDEN="Whoops! You aren't allowed to do that"),i=(t.FORBIDDEN=function(){return{status:403,code:5,category:"SecurityException",message:arguments.length>0&&void 0!==arguments[0]?arguments[0]:u}},t.MISSING_REQUIRED_PARAMETER=function(){return{status:400,code:6,category:"GeneralException",message:"A required parameter was missing"}},t.DEFAULT_SERVICE_UNAVAILABLE="Hmmm...our hamsters appear to be taking a siesta"),a=(t.SERVICE_UNAVAILABLE=function(){return{status:503,code:7,category:"NetworkException",message:arguments.length>0&&void 0!==arguments[0]?arguments[0]:i}},t.DEFAULT_VALIDATION_ERROR="Hmmm...the hamsters found a problem with that data");t.VALIDATION_ERROR=function(){return{status:400,code:8,category:"ValidationException",message:arguments.length>0&&void 0!==arguments[0]?arguments[0]:a}}},"./src/error/index.js":function(e,t,r){"use strict";t.__esModule=!0,t.codes=t.ServiceUnavailableError=t.InvalidRequestError=t.InternalError=t.AuthorizationError=t.default=void 0;var n=r("./src/error/utils.js"),o=function(e){if(e&&e.__esModule)return e;var t={};if(null!=e)for(var r in e)Object.prototype.hasOwnProperty.call(e,r)&&(t[r]=e[r]);return t.default=e,t}(r("./src/error/codes.js"));function s(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}function u(e,t){if(!e)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return!t||"object"!=typeof t&&"function"!=typeof t?e:t}function i(e,t){if("function"!=typeof t&&null!==t)throw new TypeError("Super expression must either be null or a function, not "+typeof t);e.prototype=Object.create(t&&t.prototype,{constructor:{value:e,enumerable:!1,writable:!0,configurable:!0}}),t&&(Object.setPrototypeOf?Object.setPrototypeOf(e,t):e.__proto__=t)}var a=function(e){function t(r,o,i){s(this,t);var a=u(this,e.call(this,(0,n.resolveMessage)(r)));return a.code=(0,n.resolveCode)(r),a.status=null!=o?(0,n.resolveStatus)(o):(0,n.resolveStatus)(r),a.error=o instanceof Error?i:o,"function"==typeof Error.captureStackTrace?Error.captureStackTrace(a,a.constructor):a.stack=new Error(a.message).stack,a}return i(t,e),t}(Error);t.default=a;t.AuthorizationError=function(e){function t(r){return s(this,t),u(this,e.call(this,o.NOT_ALLOWED,r))}return i(t,e),t}(a),t.InternalError=function(e){function t(r,n){return s(this,t),u(this,e.call(this,o.FATAL_ERROR(r),n))}return i(t,e),t}(a),t.InvalidRequestError=function(e){function t(r,n){return s(this,t),u(this,e.call(this,o.INVALID_REQUEST(r),n))}return i(t,e),t}(a),t.ServiceUnavailableError=function(e){function t(r,n){return s(this,t),u(this,e.call(this,o.SERVICE_UNAVAILABLE(r),n))}return i(t,e),t}(a);t.codes=o},"./src/error/utils.js":function(e,t,r){"use strict";t.__esModule=!0;var n="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(e){return typeof e}:function(e){return e&&"function"==typeof Symbol&&e.constructor===Symbol&&e!==Symbol.prototype?"symbol":typeof e};t.resolveCode=function(e){if("object"===(void 0===e?"undefined":n(e)))return"code"in e?o:e.code;return null!=e?e:o},t.resolveMessage=function(e){if("object"===(void 0===e?"undefined":n(e)))return"message"in e?s:e.message;return null!=e?e:s},t.resolveStatus=function(e){if("object"===(void 0===e?"undefined":n(e)))return"status"in e?u:e.status;return null!=e?e:u};var o=t.DEFAULT_CODE=0,s=t.DEFAULT_MESSAGE="An Unknown error occurred",u=t.DEFAULT_STATUS=500},"./src/main.js":function(e,t,r){"use strict";t.__esModule=!0,t.ServiceUnavailableError=t.Logger=t.InvalidRequestError=t.InternalError=t.codes=t.AuthorizationError=t.ApiError=void 0;var n=r("./src/error/index.js"),o=a(n),s=a(r("./src/utils/logger.js")),u=a(r("./src/server.js")),i=function(e){if(e&&e.__esModule)return e;var t={};if(null!=e)for(var r in e)Object.prototype.hasOwnProperty.call(e,r)&&(t[r]=e[r]);return t.default=e,t}(r("./src/error/codes.js"));function a(e){return e&&e.__esModule?e:{default:e}}t.default=u.default,t.ApiError=o.default,t.AuthorizationError=n.AuthorizationError,t.codes=i,t.InternalError=n.InternalError,t.InvalidRequestError=n.InvalidRequestError,t.Logger=s.default,t.ServiceUnavailableError=n.ServiceUnavailableError},"./src/middleware/accessLogger.js":function(e,t,r){"use strict";t.__esModule=!0,t.formatter=void 0;var n=o(r("koa-morgan"));function o(e){return e&&e.__esModule?e:{default:e}}var s=o(r("./src/utils/logger.js")).default.getLogger("access"),u=t.formatter=function(e,t,r){var n=e["response-time"](t,r);return JSON.stringify({"remote-addr":e["remote-addr"](t),date:e.date(t,r,"clf"),method:e.method(t),url:e.url(t),HTTP:e["http-version"](t),"user-agent":e["user-agent"](t),referrer:e.referrer(t),status:e.status(t,r),"res[content-length]":e.res(t,r,"content-length"),"response-time":n+" ms"})};t.default=(0,n.default)(u,{stream:{write:function(e){s.info(JSON.parse(e))}}})},"./src/middleware/error.js":function(e,t,r){"use strict";t.__esModule=!0;var n=r("./src/error/index.js"),o=s(n);function s(e){return e&&e.__esModule?e:{default:e}}var u=s(r("./src/utils/logger.js")).default.getLogger("root");t.default=function(){var e=function(e){return function(){var t=e.apply(this,arguments);return new Promise(function(e,r){return function n(o,s){try{var u=t[o](s),i=u.value}catch(e){return void r(e)}if(!u.done)return Promise.resolve(i).then(function(e){n("next",e)},function(e){n("throw",e)});e(i)}("next")})}}(regeneratorRuntime.mark(function e(t,r){var s;return regeneratorRuntime.wrap(function(e){for(;;)switch(e.prev=e.next){case 0:return e.prev=0,e.next=3,r();case 3:e.next=13;break;case 5:e.prev=5,e.t0=e.catch(0),s=e.t0,e.t0 instanceof o.default||(s=s.status&&500!==s.status?new o.default(e.t0.message,e.t0):new n.InternalError(e.t0.message,e.t0)),u.error(s,t),t.status=s.status,t.body=s,t.app.emit("error",s,t);case 13:case"end":return e.stop()}},e,void 0,[[0,5]])}));return function(t,r){return e.apply(this,arguments)}}()},"./src/middleware/transaction.js":function(e,t,r){"use strict";t.__esModule=!0;var n=s(r("domain")),o=s(r("uuid/v4"));function s(e){return e&&e.__esModule?e:{default:e}}t.default=function(e,t){var r=(0,o.default)(),s=n.default.create();return e.transactionId=r,s.add(e),s.data={id:r,ctx:e},new Promise(function(e,r){s.run(function(e){return function(){var t=e.apply(this,arguments);return new Promise(function(e,r){return function n(o,s){try{var u=t[o](s),i=u.value}catch(e){return void r(e)}if(!u.done)return Promise.resolve(i).then(function(e){n("next",e)},function(e){n("throw",e)});e(i)}("next")})}}(regeneratorRuntime.mark(function n(){return regeneratorRuntime.wrap(function(n){for(;;)switch(n.prev=n.next){case 0:return n.prev=0,n.next=3,t();case 3:return n.abrupt("return",e());case 6:return n.prev=6,n.t0=n.catch(0),n.abrupt("return",r(n.t0));case 9:case"end":return n.stop()}},n,void 0,[[0,6]])})))})}},"./src/router.js":function(e,t,r){"use strict";t.__esModule=!0;var n=s(r("koa-router")),o=s(r("./src/api/v1/routes/index.js"));function s(e){return e&&e.__esModule?e:{default:e}}var u=new n.default;u.use(o.default.routes()),t.default=u},"./src/server.js":function(e,t,r){"use strict";t.__esModule=!0,t.default=void 0;var n=E(r("koa-body")),o=E(r("koa-compress")),s=E(r("koa-cors")),u=E(r("events")),i=E(r("fs")),a=E(r("koa-helmet")),c=E(r("https")),l=E(r("koa")),f=E(r("./src/middleware/accessLogger.js")),d=E(r("./src/middleware/error.js")),p=E(r("./src/utils/logger.js")),h=E(r("./src/router.js")),g=E(r("./src/utils/sigInitHandler.js")),v=E(r("./src/middleware/transaction.js")),m=E(r("./src/utils/uncaughtExceptionHandler.js")),y=E(r("./src/utils/unhandledRejectionHandler.js"));function E(e){return e&&e.__esModule?e:{default:e}}process.on("SIGINT",g.default),process.on("uncaughtException",m.default),process.on("unhandledRejection",y.default);var _=function(e){function t(r){var n=arguments.length>1&&void 0!==arguments[1]?arguments[1]:null;!function(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}(this,t);var o=function(e,t){if(!e)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return!t||"object"!=typeof t&&"function"!=typeof t?e:t}(this,e.call(this));return o.router=h.default,process.on("exit",o.destroy),o.config=r,o.app=new l.default,o.logger=p.default.getLogger("app"),o.initialize(),n&&o.router.use(n.routes()),o.app.use(o.router.routes()),o.app.use(o.router.allowedMethods()),o.emit("ready"),o}return function(e,t){if("function"!=typeof t&&null!==t)throw new TypeError("Super expression must either be null or a function, not "+typeof t);e.prototype=Object.create(t&&t.prototype,{constructor:{value:e,enumerable:!1,writable:!0,configurable:!0}}),t&&(Object.setPrototypeOf?Object.setPrototypeOf(e,t):e.__proto__=t)}(t,e),t.prototype.createServer=function(){return this.config.server.secure?this.createHttpsServer():this.app},t.prototype.createHttpsServer=function(){this.app.use(function(e,t){return e.secure?t():e.redirect("https://"+e.hostname+":"+this.config.server.port+e.url)});var e=this.config.server.ssl,t=Object.assign({},e,{key:i.default.readFileSync(e.key),cert:i.default.readFileSync(e.cert)});return c.default.createServer(t,this.app.callback())},t.prototype.getListenCallback=function(e){var t=this;return function(){null!=e&&e(),t.emit("start"),process.send&&process.send("ready"),t.logger.info("Server listening at "+t.config.server.hostname+":"+t.config.server.port+"...")}},t.prototype.initialize=function(){this.app.use((0,a.default)()),this.app.use((0,s.default)(this.config.cors)),this.app.use((0,o.default)(this.config.compress)),this.app.use((0,n.default)(this.config.body)),this.app.use(v.default),this.app.use(f.default),this.app.use(d.default)},t.prototype.initializeRouter=function(e){return e&&h.default.use(e.routes()),this.app.use(h.default.routes()),this.app.use(h.default.allowedMethods()),h.default},t.prototype.destroy=function(){this.emit("destroy"),process.emit("destroy")},t.prototype.start=function(){var e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:null;if(!this.app)throw new Error("Cannot start server: the express instance is not defined");try{return this.emit("before:start"),this.app.server=this.createServer().listen(this.config.get("port"),this.config.get("hostname"),this.config.get("backlog"),this.getListenCallback(e)),this.emit("after:start"),this.app.server}catch(e){return this.logger.error(e),this.destroy(),null}},t.prototype.stop=function(){var e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:null;this.logger.info("Server ("+this.config.hostname+":"+this.config.port+") stopping..."),this.emit("before:stop"),e&&e(),this.app.server.close(),this.destroy(),this.emit("after:stop")},t}(u.default);t.default=_},"./src/utils/logger.js":function(e,t,r){"use strict";var n,o;t.__esModule=!0,t.DEFAULT_LOGGER_NAME=void 0;var s=a(r("bunyan")),u=a(r("config")),i=a(r("process"));function a(e){return e&&e.__esModule?e:{default:e}}var c=t.DEFAULT_LOGGER_NAME="root",l=(o=n=function(e){function t(){return function(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}(this,t),function(e,t){if(!e)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return!t||"object"!=typeof t&&"function"!=typeof t?e:t}(this,e.apply(this,arguments))}return function(e,t){if("function"!=typeof t&&null!==t)throw new TypeError("Super expression must either be null or a function, not "+typeof t);e.prototype=Object.create(t&&t.prototype,{constructor:{value:e,enumerable:!1,writable:!0,configurable:!0}}),t&&(Object.setPrototypeOf?Object.setPrototypeOf(e,t):e.__proto__=t)}(t,e),t.prototype._emit=function(t,r){var n=this.serializeTransaction(t);return e.prototype._emit.call(this,n,r)},t.prototype.serializeTransaction=function(e){var t=e,r=i.default.domain;if(r&&r.data){var n=r.data.ctx;t.transactionId=r.data.id,n.session&&(t.sessionId=n.session.id),n.user&&(t.user={id:n.user.id,username:n.user.username})}return e},t.getLogger=function(){var e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:null,r=u.default.loggers.handlers,n=null==e?c:e.toLowerCase();if(!(n in t.loggers)){if(!(n in r))throw new Error('Unable to create logger: no logger for "'+n+'" found in configuration');t.loggers[n]=new t(r[n])}return t.loggers[n]},t}(s.default),n.loggers={},o);t.default=l},"./src/utils/sigInitHandler.js":function(e,t,r){"use strict";t.__esModule=!0,t.default=function(){n&&n.info("Captured ctrl-c");process.exit(0)};var n=function(e){return e&&e.__esModule?e:{default:e}}(r("./src/utils/logger.js")).default.getLogger()},"./src/utils/uncaughtExceptionHandler.js":function(e,t,r){"use strict";t.__esModule=!0,t.default=function(e){n&&(n.error("An unhandled exception occurred. Server is exiting..."),n.error(e));process.exit(1)};var n=function(e){return e&&e.__esModule?e:{default:e}}(r("./src/utils/logger.js")).default.getLogger("error")},"./src/utils/unhandledRejectionHandler.js":function(e,t,r){"use strict";t.__esModule=!0,t.default=function(e){n&&n.error("An unhandled promise rejection occurred: "+e)};var n=function(e){return e&&e.__esModule?e:{default:e}}(r("./src/utils/logger.js")).default.getLogger("error")},0:function(e,t,r){e.exports=r("./src/main.js")},bunyan:function(e,t){e.exports=require("bunyan")},config:function(e,t){e.exports=require("config")},domain:function(e,t){e.exports=require("domain")},events:function(e,t){e.exports=require("events")},fs:function(e,t){e.exports=require("fs")},https:function(e,t){e.exports=require("https")},koa:function(e,t){e.exports=require("koa")},"koa-body":function(e,t){e.exports=require("koa-body")},"koa-compress":function(e,t){e.exports=require("koa-compress")},"koa-cors":function(e,t){e.exports=require("koa-cors")},"koa-helmet":function(e,t){e.exports=require("koa-helmet")},"koa-morgan":function(e,t){e.exports=require("koa-morgan")},"koa-router":function(e,t){e.exports=require("koa-router")},process:function(e,t){e.exports=require("process")},"uuid/v4":function(e,t){e.exports=require("uuid/v4")}});
//# sourceMappingURL=axon.js.map