module.exports=function(e){var t={};function r(o){if(t[o])return t[o].exports;var n=t[o]={i:o,l:!1,exports:{}};return e[o].call(n.exports,n,n.exports,r),n.l=!0,n.exports}return r.m=e,r.c=t,r.d=function(e,t,o){r.o(e,t)||Object.defineProperty(e,t,{configurable:!1,enumerable:!0,get:o})},r.r=function(e){Object.defineProperty(e,"__esModule",{value:!0})},r.n=function(e){var t=e&&e.__esModule?function(){return e.default}:function(){return e};return r.d(t,"a",t),t},r.o=function(e,t){return Object.prototype.hasOwnProperty.call(e,t)},r.p="",r.w={},r(r.s=0)}({"./src/api/v1/handlers/health.js":function(e,t,r){"use strict";t.__esModule=!0,t.default=function(){var e,t=(e=regeneratorRuntime.mark(function e(t){return regeneratorRuntime.wrap(function(e){for(;;)switch(e.prev=e.next){case 0:t.status=200,t.body="OK";case 2:case"end":return e.stop()}},e,this)}),function(){var t=e.apply(this,arguments);return new Promise(function(e,r){return function o(n,s){try{var i=t[n](s),u=i.value}catch(e){return void r(e)}if(!i.done)return Promise.resolve(u).then(function(e){o("next",e)},function(e){o("throw",e)});e(u)}("next")})});return function(e){return t.apply(this,arguments)}}()},"./src/api/v1/routes/index.js":function(e,t,r){"use strict";t.__esModule=!0;var o=s(r("koa-router")),n=s(r("./src/api/v1/handlers/health.js"));function s(e){return e&&e.__esModule?e:{default:e}}var i=new o.default;i.get("/health",n.default),t.default=i},"./src/error/codes.js":function(e,t,r){"use strict";t.__esModule=!0;var o=t.DEFAULT_FATAL_ERROR="An error occurred. If this error persists, please contact your System Administrator",n=(t.FATAL_ERROR=function(){return{status:500,code:-1,category:"IllegalStateException",message:arguments.length>0&&void 0!==arguments[0]?arguments[0]:o}},t.DEFAULT_GENERAL_ERROR="Our hamsters don't know how to handle that request"),s=(t.GENERAL_ERROR=function(){return{status:400,code:"0a",category:"GeneralException",message:arguments.length>0&&void 0!==arguments[0]?arguments[0]:n}},t.NOT_YET_IMPLEMENTED=function(){return{status:501,code:1,category:"NotYetImplemented",message:"This method must be implmented"}},t.ILLEGAL_STATE_EXCEPTION=function(){return{status:500,code:2,category:"IllegalStateException",message:"Application not configured correctly"}},t.DEFAULT_INVALID_REQUEST="Our hamsters don't know how to handle that request"),i=(t.INVALID_REQUEST=function(){return{status:400,code:3,category:"UserError",message:arguments.length>0&&void 0!==arguments[0]?arguments[0]:s}},t.UNAUTHORIZED=function(){return{status:401,code:4,category:"SecurityException",message:arguments.length>0&&void 0!==arguments[0]?arguments[0]:"Your session is no longer valid. Please login and rety"}},t.DEFAULT_FORBIDDEN="Whoops! You aren't allowed to do that"),u=(t.FORBIDDEN=function(){return{status:403,code:5,category:"SecurityException",message:arguments.length>0&&void 0!==arguments[0]?arguments[0]:i}},t.MISSING_REQUIRED_PARAMETER=function(){return{status:400,code:6,category:"GeneralException",message:"A required parameter was missing"}},t.DEFAULT_SERVICE_UNAVAILABLE="Hmmm...our hamsters appear to be taking a siesta"),a=(t.SERVICE_UNAVAILABLE=function(){return{status:503,code:7,category:"NetworkException",message:arguments.length>0&&void 0!==arguments[0]?arguments[0]:u}},t.DEFAULT_VALIDATION_ERROR="Hmmm...the hamsters found a problem with that data");t.VALIDATION_ERROR=function(){return{status:400,code:8,category:"ValidationException",message:arguments.length>0&&void 0!==arguments[0]?arguments[0]:a}}},"./src/error/index.js":function(e,t,r){"use strict";t.__esModule=!0,t.codes=t.ServiceUnavailableError=t.InvalidRequestError=t.InternalError=t.AuthorizationError=t.default=void 0;var o=r("./src/error/utils.js"),n=function(e){if(e&&e.__esModule)return e;var t={};if(null!=e)for(var r in e)Object.prototype.hasOwnProperty.call(e,r)&&(t[r]=e[r]);return t.default=e,t}(r("./src/error/codes.js"));function s(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}function i(e,t){if(!e)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return!t||"object"!=typeof t&&"function"!=typeof t?e:t}function u(e,t){if("function"!=typeof t&&null!==t)throw new TypeError("Super expression must either be null or a function, not "+typeof t);e.prototype=Object.create(t&&t.prototype,{constructor:{value:e,enumerable:!1,writable:!0,configurable:!0}}),t&&(Object.setPrototypeOf?Object.setPrototypeOf(e,t):e.__proto__=t)}var a=function(e){function t(r,n,u){s(this,t);var a=i(this,e.call(this,(0,o.resolveMessage)(r)));return a.code=(0,o.resolveCode)(r),a.status=null!=n?(0,o.resolveStatus)(n):(0,o.resolveStatus)(r),a.error=n instanceof Error?u:n,"function"==typeof Error.captureStackTrace?Error.captureStackTrace(a,a.constructor):a.stack=new Error(a.message).stack,a}return u(t,e),t}(Error);t.default=a;t.AuthorizationError=function(e){function t(r){return s(this,t),i(this,e.call(this,n.NOT_ALLOWED,r))}return u(t,e),t}(a),t.InternalError=function(e){function t(r,o){return s(this,t),i(this,e.call(this,n.FATAL_ERROR(r),o))}return u(t,e),t}(a),t.InvalidRequestError=function(e){function t(r,o){return s(this,t),i(this,e.call(this,n.INVALID_REQUEST(r),o))}return u(t,e),t}(a),t.ServiceUnavailableError=function(e){function t(r,o){return s(this,t),i(this,e.call(this,n.SERVICE_UNAVAILABLE(r),o))}return u(t,e),t}(a);t.codes=n},"./src/error/utils.js":function(e,t,r){"use strict";t.__esModule=!0;var o="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(e){return typeof e}:function(e){return e&&"function"==typeof Symbol&&e.constructor===Symbol&&e!==Symbol.prototype?"symbol":typeof e};t.resolveCode=function(e){if("object"===(void 0===e?"undefined":o(e)))return"code"in e?n:e.code;return null!=e?e:n},t.resolveMessage=function(e){if("object"===(void 0===e?"undefined":o(e)))return"message"in e?s:e.message;return null!=e?e:s},t.resolveStatus=function(e){if("object"===(void 0===e?"undefined":o(e)))return"status"in e?i:e.status;return null!=e?e:i};var n=t.DEFAULT_CODE=0,s=t.DEFAULT_MESSAGE="An Unknown error occurred",i=t.DEFAULT_STATUS=500},"./src/main.js":function(e,t,r){"use strict";t.__esModule=!0,t.ServiceUnavailableError=t.Logger=t.InvalidRequestError=t.InternalError=t.codes=t.AuthorizationError=t.ApiError=void 0;var o=r("./src/error/index.js"),n=a(o),s=a(r("./src/utils/logger.js")),i=a(r("./src/server.js")),u=function(e){if(e&&e.__esModule)return e;var t={};if(null!=e)for(var r in e)Object.prototype.hasOwnProperty.call(e,r)&&(t[r]=e[r]);return t.default=e,t}(r("./src/error/codes.js"));function a(e){return e&&e.__esModule?e:{default:e}}t.default=i.default,t.ApiError=n.default,t.AuthorizationError=o.AuthorizationError,t.codes=u,t.InternalError=o.InternalError,t.InvalidRequestError=o.InvalidRequestError,t.Logger=s.default,t.ServiceUnavailableError=o.ServiceUnavailableError},"./src/middleware/accessLogger.js":function(e,t,r){"use strict";t.__esModule=!0,t.formatter=void 0;var o=n(r("koa-morgan"));function n(e){return e&&e.__esModule?e:{default:e}}var s=n(r("./src/utils/logger.js")).default.getLogger("access"),i=t.formatter=function(e,t,r){var o=e["response-time"](t,r);return JSON.stringify({"remote-addr":e["remote-addr"](t),date:e.date(t,r,"clf"),method:e.method(t),url:e.url(t),HTTP:e["http-version"](t),"user-agent":e["user-agent"](t),referrer:e.referrer(t),status:e.status(t,r),"res[content-length]":e.res(t,r,"content-length"),"response-time":o+" ms"})};t.default=(0,o.default)(i,{stream:{write:function(e){s.info(JSON.parse(e))}}})},"./src/middleware/error.js":function(e,t,r){"use strict";t.__esModule=!0;var o=r("./src/error/index.js"),n=s(o);function s(e){return e&&e.__esModule?e:{default:e}}var i,u,a=s(r("./src/utils/logger.js")).default.getLogger("root");t.default=(i=regeneratorRuntime.mark(function e(t,r){var s;return regeneratorRuntime.wrap(function(e){for(;;)switch(e.prev=e.next){case 0:return e.prev=0,e.next=3,r();case 3:e.next=13;break;case 5:e.prev=5,e.t0=e.catch(0),s=e.t0,e.t0 instanceof n.default||(s=s.status&&500!==s.status?new n.default(e.t0.message,e.t0):new o.InternalError(e.t0.message,e.t0)),a.error(s,t),t.status=s.status,t.body=s,t.app.emit("error",s,t);case 13:case"end":return e.stop()}},e,void 0,[[0,5]])}),u=function(){var e=i.apply(this,arguments);return new Promise(function(t,r){return function o(n,s){try{var i=e[n](s),u=i.value}catch(e){return void r(e)}if(!i.done)return Promise.resolve(u).then(function(e){o("next",e)},function(e){o("throw",e)});t(u)}("next")})},function(e,t){return u.apply(this,arguments)})},"./src/middleware/transaction.js":function(e,t,r){"use strict";t.__esModule=!0;var o=s(r("domain")),n=s(r("uuid/v4"));function s(e){return e&&e.__esModule?e:{default:e}}t.default=function(e,t){var r=(0,n.default)(),s=o.default.create();return e.transactionId=r,s.add(e),s.data={id:r,ctx:e},new Promise(function(e,r){var o;s.run((o=regeneratorRuntime.mark(function o(){return regeneratorRuntime.wrap(function(o){for(;;)switch(o.prev=o.next){case 0:return o.prev=0,o.next=3,t();case 3:return o.abrupt("return",e());case 6:return o.prev=6,o.t0=o.catch(0),o.abrupt("return",r(o.t0));case 9:case"end":return o.stop()}},o,void 0,[[0,6]])}),function(){var e=o.apply(this,arguments);return new Promise(function(t,r){return function o(n,s){try{var i=e[n](s),u=i.value}catch(e){return void r(e)}if(!i.done)return Promise.resolve(u).then(function(e){o("next",e)},function(e){o("throw",e)});t(u)}("next")})}))})}},"./src/router.js":function(e,t,r){"use strict";t.__esModule=!0;var o=s(r("koa-router")),n=s(r("./src/api/v1/routes/index.js"));function s(e){return e&&e.__esModule?e:{default:e}}var i=new o.default;i.use(n.default.routes()),t.default=i},"./src/server.js":function(e,t,r){"use strict";t.__esModule=!0,t.default=void 0;var o=E(r("koa-body")),n=E(r("koa-compress")),s=E(r("koa-cors")),i=E(r("events")),u=E(r("fs")),a=E(r("koa-helmet")),c=E(r("https")),l=E(r("koa")),f=(E(r("koa-mount")),E(r("koa-static")),E(r("./src/middleware/accessLogger.js"))),d=E(r("./src/middleware/error.js")),p=E(r("./src/utils/logger.js")),h=E(r("./src/router.js")),g=E(r("./src/utils/sigInitHandler.js")),v=E(r("./src/middleware/transaction.js")),m=E(r("./src/utils/uncaughtExceptionHandler.js")),y=E(r("./src/utils/unhandledRejectionHandler.js"));function E(e){return e&&e.__esModule?e:{default:e}}process.on("SIGINT",g.default),process.on("uncaughtException",m.default),process.on("unhandledRejection",y.default);var _=function(e){function t(r,o){!function(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}(this,t);var n=function(e,t){if(!e)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return!t||"object"!=typeof t&&"function"!=typeof t?e:t}(this,e.call(this));return process.on("exit",n.destroy),n.config=r,n.app=new l.default,n.logger=p.default.getLogger("app"),n.initialize(),n.initializeRouter(h.default,o),n.emit("ready"),n}return function(e,t){if("function"!=typeof t&&null!==t)throw new TypeError("Super expression must either be null or a function, not "+typeof t);e.prototype=Object.create(t&&t.prototype,{constructor:{value:e,enumerable:!1,writable:!0,configurable:!0}}),t&&(Object.setPrototypeOf?Object.setPrototypeOf(e,t):e.__proto__=t)}(t,e),t.prototype.createServer=function(){return this.config.server.secure?this.createHttpsServer():this.app},t.prototype.createHttpsServer=function(){this.app.all("*",function(e,t,r){return e.secure?r():t.redirect("https://"+e.hostname+":"+this.config.server.port+e.url)});var e=this.config.server.ssl,t=Object.assign({},e,{key:u.default.readFileSync(e.get("key")),cert:u.default.readFileSync(e.get("cert"))});return c.default.createServer(t,this.app.callback())},t.prototype.getListenCallback=function(e){var t=this;return function(){null!=e&&e(),t.emit("start"),process.send&&process.send("ready"),t.logger.info("Server listening at "+t.config.server.hostname+":"+t.config.server.port+"...")}},t.prototype.initialize=function(){this.app.use((0,a.default)()),this.app.use((0,s.default)(this.config.get("cors"))),this.app.use((0,n.default)(this.config.get("compress"))),this.app.use((0,o.default)(this.config.get("body"))),this.app.use(v.default),this.app.use(f.default),this.app.use(d.default),this.initializeMiddleware()},t.prototype.initializeMiddleware=function(){},t.prototype.initializeRouter=function(e,t){e.use(t.routes()),this.app.use(e.routes()),this.app.use(e.allowedMethods())},t.prototype.destroy=function(){this.emit("destroy"),process.emit("destroy")},t.prototype.start=function(){var e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:null;if(!this.app)throw new Error("Cannot start server: the express instance is not defined");try{return this.emit("before:start"),this.app.server=this.createServer().listen(this.config.get("port"),this.config.get("hostname"),this.config.get("backlog"),this.getListenCallback(e)),this.emit("after:start"),this.app.server}catch(e){throw this.logger.error(e),this.destroy(),e}},t.prototype.stop=function(){var e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:null;this.logger.info("Server ("+this.config.hostname+":"+this.config.port+") stopping..."),this.emit("before:stop"),e&&e(),this.app.server.close(),this.destroy(),this.emit("after:stop")},t}(i.default);t.default=_},"./src/utils/logger.js":function(e,t,r){"use strict";var o,n;t.__esModule=!0,t.DEFAULT_LOGGER_NAME=void 0;var s=a(r("bunyan")),i=a(r("config")),u=a(r("process"));function a(e){return e&&e.__esModule?e:{default:e}}var c=t.DEFAULT_LOGGER_NAME="root",l=(n=o=function(e){function t(){return function(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}(this,t),function(e,t){if(!e)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return!t||"object"!=typeof t&&"function"!=typeof t?e:t}(this,e.apply(this,arguments))}return function(e,t){if("function"!=typeof t&&null!==t)throw new TypeError("Super expression must either be null or a function, not "+typeof t);e.prototype=Object.create(t&&t.prototype,{constructor:{value:e,enumerable:!1,writable:!0,configurable:!0}}),t&&(Object.setPrototypeOf?Object.setPrototypeOf(e,t):e.__proto__=t)}(t,e),t.prototype._emit=function(t,r){var o=this.serializeTransaction(t);return e.prototype._emit.call(this,o,r)},t.prototype.serializeTransaction=function(e){var t=e,r=u.default.domain;if(r&&r.data){var o=r.data.ctx;t.transactionId=r.data.id,o.session&&(t.sessionId=o.session.id),o.user&&(t.user={id:o.user.id,username:o.user.username})}return e},t.getLogger=function(){var e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:null,r=i.default.loggers.handlers,o=null==e?c:e.toLowerCase();if(!(o in t.loggers)){if(!(o in r))throw new Error("Unable to create logger: no logger for "+o+" found in configuration");t.loggers[o]=new t(r.loggerName)}return t.loggers[o]},t}(s.default),o.loggers={},n);t.default=l},"./src/utils/sigInitHandler.js":function(e,t,r){"use strict";t.__esModule=!0,t.default=function(){s&&s.info("Captured ctrl-c");process.exit(0)};var o,n=r("./src/utils/logger.js");var s=((o=n)&&o.__esModule?o:{default:o}).default.getLogger()},"./src/utils/uncaughtExceptionHandler.js":function(e,t,r){"use strict";t.__esModule=!0,t.default=function(e){s&&(s.error("An unhandled exception occurred. Server is exiting..."),s.error(e));process.exit(1)};var o,n=r("./src/utils/logger.js");var s=((o=n)&&o.__esModule?o:{default:o}).default.getLogger("error")},"./src/utils/unhandledRejectionHandler.js":function(e,t,r){"use strict";t.__esModule=!0,t.default=function(e){s&&s.error("An unhandled promise rejection occurred: "+e)};var o,n=r("./src/utils/logger.js");var s=((o=n)&&o.__esModule?o:{default:o}).default.getLogger("error")},0:function(e,t,r){e.exports=r("./src/main.js")},bunyan:function(e,t){e.exports=require("bunyan")},config:function(e,t){e.exports=require("config")},domain:function(e,t){e.exports=require("domain")},events:function(e,t){e.exports=require("events")},fs:function(e,t){e.exports=require("fs")},https:function(e,t){e.exports=require("https")},koa:function(e,t){e.exports=require("koa")},"koa-body":function(e,t){e.exports=require("koa-body")},"koa-compress":function(e,t){e.exports=require("koa-compress")},"koa-cors":function(e,t){e.exports=require("koa-cors")},"koa-helmet":function(e,t){e.exports=require("koa-helmet")},"koa-morgan":function(e,t){e.exports=require("koa-morgan")},"koa-mount":function(e,t){e.exports=require("koa-mount")},"koa-router":function(e,t){e.exports=require("koa-router")},"koa-static":function(e,t){e.exports=require("koa-static")},process:function(e,t){e.exports=require("process")},"uuid/v4":function(e,t){e.exports=require("uuid/v4")}});
//# sourceMappingURL=axon.js.map